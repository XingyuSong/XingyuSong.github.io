<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    Download literatures from CNKI through requests+bs4+selenium |
    
    送信鱼</title>
  
  <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-Download-literatures-from-CNKI-through-requests-bs4-selenium" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h1 class="article-title" itemprop="name">
  Download literatures from CNKI through requests+bs4+selenium
</h1>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/02/03/Download-literatures-from-CNKI-through-requests-bs4-selenium/" class="article-date">
  <time datetime="2021-02-03T07:41:56.000Z" itemprop="datePublished">2021-02-03</time>
</a>
      
    </div>
    

    
    
    

    <div class="article-entry" itemprop="articleBody">
      
      
      
      <p>##总体流程<br>高级检索—&gt;获取框架—&gt;get概览页链接—&gt;get文献链接（保存）—&gt;Webdriver打开链接—&gt;点击pdf按钮（保存，下载到本地）</p>
<p>##主要代码<br>#需要加载的包<br>import requests<br>import os<br>from bs4 import BeautifulSoup<br>from selenium import webdriver<br>import time</p>
<p>#设置网页请求头<br>HEADERS={<br>        “Accept”: “text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8”,<br>        “Accept-Encoding”: “gzip, deflate”,<br>        “Accept-Language”: “zh-CN,zh;q=0.9”,<br>        “Cache-Control”: “no-cache”,<br>        “Connection”: “keep-alive”,<br>        “Cookie”: “Ecp_notFirstLogin=Iob0hp; UM_distinctid=161fbb14dc16d8-0fe704002eaed2-3b60450b-e1000-161fbb14dc28d2; cnkiUserKey=863e4b9d-dd18-606d-0242-1b941922c10d; Ecp_ClientId=5180306222203671801; amid=518fa494-75d3-454a-ab86-19cb5f24bd92; ASP.NET_SessionId=bxvp5guwiwzmshoyrgxojuuw; SID_kns=123118; SID_klogin=125142; SID_krsnew=125131; SID_kcms=124102; SID_knsdelivery=125122; RsPerPage=50; SID_kxreader_new=011122; CNZZDATA3258975=cnzz_eid%3D745562340-1520342518-http%253A%252F%252Fxueshu.baidu.com%252F%26ntime%3D1525697997; Ecp_lout=1; IsLogin=; Ecp_session=1; LID=WEEvREcwSlJHSldRa1Fhb09jSnZqRWhNWDVndGw0aFFyc3UxZjlEajZYMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4ggI8Fm4gTkoUKaID8j8gFw!!; _pk_ref=%5B%22%22%2C%22%22%2C1525921651%2C%22http%3A%2F%2F<a href="http://www.cnki.net%2F%22%5D">www.cnki.net%2F%22%5D</a>; _pk_id=dbca1575-aae3-4cd6-a876-e51871215fd5.1521100425.79.1525921651.1525921651.; _pk_ses=*; Ecp_LoginStuts=%7B%22IsAutoLogin%22%3Afalse%2C%22UserName%22%3A%22nj0232%22%2C%22ShowName%22%3A%22%25E8%258B%258F%25E5%25B7%259E%25E5%25A4%25A7%25E5%25AD%25A6%25E5%259B%25BE%25E4%25B9%25A6%25E9%25A6%2586%22%2C%22UserType%22%3A%22bk%22%2C%22r%22%3A%22Iob0hp%22%7D; c_m_LinID=LinID=WEEvREcwSlJHSldRa1Fhb09jSnZqRWhNWDVndGw0aFFyc3UxZjlEajZYMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4ggI8Fm4gTkoUKaID8j8gFw!!&amp;ot=05/10/2018 11:27:47; c_m_expire=2018-05-10 11:27:47”,<br>        “Host”: “kns.cnki.net”,<br>        “Pragma”: “no-cache”,<br>        “Referer”: “<a target="_blank" rel="noopener" href="http://kns.cnki.net/kns/brief/result.aspx?dbprefix=SCDB&quot;">http://kns.cnki.net/kns/brief/result.aspx?dbprefix=SCDB&quot;</a>,<br>        “Upgrade-Insecure-Requests”: “1”,<br>        “User-Agent”: “Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36”}</p>
<p>#读取所有文献的链接并存入文档<br>def get_page(url,i):<br>    fn = “0509geturl.txt”<br>    fw = open(fn, ‘a’)<br>    #设置网页框架请求数据<br>    DATA = {<br>        “curpage”: i,<br>        “RecordsPerPage”: “50”,<br>        “QueryID”: “7”,<br>        “turnpage”: “1”,<br>        “tpagemode”: “L”,<br>        “dbPrefix”: “SCDB”,<br>        “DisplayMode”: “listmode”,<br>        “PageName”: “ASP.brief_result_aspx”,<br>        “ConfigFile”: “SCDB.xml”,<br>        “t”: “1525146679451”,<br>    }<br>    str1= “<a target="_blank" rel="noopener" href="http://kns.cnki.net&quot;/">http://kns.cnki.net&quot;</a><br>    str2 = “<a target="_blank" rel="noopener" href="http://kns.cnki.net&quot;/">http://kns.cnki.net&quot;</a></p>
<pre><code>r = requests.post(url, data=DATA, headers=HEADERS)
#
bs = BeautifulSoup(r.text, &quot;lxml&quot;)
sl = bs.find_all(&quot;a&quot;, attrs=&#123;&quot;class&quot;: &quot;fz14&quot;&#125;)
print (&quot;第&#123;&#125;页&quot;.format(i))
print(len(sl))
url_info=[]
for i in sl:
    str1+=i[&quot;href&quot;]#str1为未进行重定向的文献链接
    s = requests.session()
    s.headers = HEADERS
    html = s.get(str1, allow_redirects=False)
    str2+=html.headers[&#39;Location&#39;]
    #print(str2)
    url_info.append(str2)
    str1 = &quot;http://kns.cnki.net&quot;
    str2 = &quot;http://kns.cnki.net&quot;
for i in url_info:
    print(i)
    fw.write(i.encode(&#39;utf-8&#39;) + &quot;\n&quot;)
</code></pre>
<p>######输出每一篇文献的标题、单位和摘要<br>def get_info(str):<br>    fn = “cnki2.txt”<br>    fw = open(fn, ‘a’)<br>    title=[]<br>    info=[]<br>    res = requests.get(str,headers=HEADERS)<br>    soup = BeautifulSoup(res.text,”lxml”)<br>    title = soup.select(‘h2’)<br>    info.append(title[0].text)<br>    for i in soup.find_all(“div”,attrs={“class”:”orgn”}):<br>        info.append(i.text)<br>    for i in soup.find_all(“span”,attrs={“id”: “ChDivSummary”}):<br>        info.append(i.text)<br>    for i in info:<br>        print(i.encode(‘utf-8’))<br>        fw.write(i.encode(‘utf-8’)+”\n”)</p>
<p>def download(url):</p>
<pre><code>options = webdriver.ChromeOptions()
options.add_argument(
    &#39;user-agent=&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36&quot;&#39;)
browser = webdriver.Chrome(&#39;C:/Program Files/chromedriver.exe&#39;, chrome_options=options)
browser.get(url)
try:
    browser.find_element_by_id(&#39;pdfDown&#39;).click()
    print &quot;download success!!!&quot;
    #browser.quit()
except Exception as e:
    try:
        browser.find_element_by_id(&#39;cajDown&#39;).click()#点击下载
        print &quot;download success!!!&quot;
    except Exception as e:
        try:
            browser.find_element_by_id(&#39;DownLoadParts&#39;).click()
            print &quot;download success!!!&quot;
        except Exception as e:
            print &quot;download fail!!!&quot;
            fw.write(url.encode(&#39;utf-8&#39;) + &quot;\n&quot;)
</code></pre>
<p>def main():<br>    for i in range(61,81,1):<br>        url=”<a target="_blank" rel="noopener" href="http://kns.cnki.net/kns/brief/brief.aspx?curpage=%7B%7D&amp;RecordsPerPage=50&amp;QueryID=24&amp;ID=&amp;turnpage=1&amp;tpagemode=L&amp;dbPrefix=SCDB&amp;Fields=&amp;DisplayMode=listmode&amp;PageName=ASP.brief_result_aspx#J_ORDER&amp;&quot;.format(i)#%E5%AE%9E%E7%8E%B0%E7%BF%BB%E9%A1%B5">http://kns.cnki.net/kns/brief/brief.aspx?curpage={}&amp;RecordsPerPage=50&amp;QueryID=24&amp;ID=&amp;turnpage=1&amp;tpagemode=L&amp;dbPrefix=SCDB&amp;Fields=&amp;DisplayMode=listmode&amp;PageName=ASP.brief_result_aspx#J_ORDER&amp;&quot;.format(i)#实现翻页</a><br>        get_page(url,i)<br>        time.sleep(8)</p>
<pre><code>print(&quot;finished!&quot;)
</code></pre>
<p>if <strong>name</strong> == “<strong>main</strong>“:<br>    main()</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/03/Download-literatures-from-CNKI-through-requests-bs4-selenium/" data-id="ckkpczigp0000fpvg1qv959h9" class="article-share-link">
        Share
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>

  </div>

  
  
  

  
  
  
  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>送信鱼 &copy; 2021</li>
      
        <li>京ICP备17054916号-2</li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="送信鱼"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>





<script src="/js/tocbot.min.js"></script>

<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>